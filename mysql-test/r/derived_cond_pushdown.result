create table t1 (a int, b int, c int);
create table t2 (a int, b int, c int, d decimal);
insert into t1 values 
(1,21,345), (1,33,7), (8,33,114), (1,21,500), (1,19,107), (5,14,787),
(8,33,123), (9,10,211), (5,16,207), (1,33,988), (5,27,132), (1,21,104),
(6,20,309), (6,20,315), (1,21,101), (8,33,404), (9,10,800), (1,21,123),
(7,11,708), (6,20,214);
insert into t2 values
(2,3,207,207.0000), (1,21,909,12.0000), (7,13,312,406.0000), 
(8,64,248,107.0000), (6,20,315,279.3333), (1,19,203,107.0000),
(8,80,800,314.0000), (3,12,231,190.0000), (6,23,303,909.0000);
Warnings:
Note	1265	Data truncated for column 'd' at row 5
create view v1 as select a, b, max(c) as max_c, avg(c) as avg_c from t1 
group by a,b having max_c < 707;
select * from v1,t2 where (v1.max_c>214) and (t2.a>v1.a);
a	b	max_c	avg_c	a	b	c	d
1	21	500	234.6000	2	3	207	207
1	21	500	234.6000	7	13	312	406
1	21	500	234.6000	8	64	248	107
1	21	500	234.6000	6	20	315	279
1	21	500	234.6000	8	80	800	314
1	21	500	234.6000	3	12	231	190
1	21	500	234.6000	6	23	303	909
6	20	315	279.3333	7	13	312	406
6	20	315	279.3333	8	64	248	107
6	20	315	279.3333	8	80	800	314
explain format=json select * from v1,t2 where (v1.max_c>214) and (t2.a>v1.a);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "(v1.max_c > 214)"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(t2.a > v1.a)",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and (max_c > 214))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where 
((v1.max_c>400) and (t2.a>v1.a)) or ((v1.max_c<135) and (t2.a<v1.a));
a	b	max_c	avg_c	a	b	c	d
1	21	500	234.6000	2	3	207	207
1	21	500	234.6000	7	13	312	406
1	21	500	234.6000	8	64	248	107
1	21	500	234.6000	6	20	315	279
1	21	500	234.6000	8	80	800	314
1	21	500	234.6000	3	12	231	190
1	21	500	234.6000	6	23	303	909
5	27	132	132.0000	2	3	207	207
5	27	132	132.0000	1	21	909	12
5	27	132	132.0000	1	19	203	107
5	27	132	132.0000	3	12	231	190
explain format=json
select * from v1,t2 where 
((v1.max_c>400) and (t2.a>v1.a)) or ((v1.max_c<135) and (t2.a<v1.a));
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "((v1.max_c > 400) or (v1.max_c < 135))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(((v1.max_c > 400) and (t2.a > v1.a)) or ((v1.max_c < 135) and (t2.a < v1.a)))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and ((max_c > 400) or (max_c < 135)))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where (v1.a>6) and (t2.b>v1.b);
a	b	max_c	avg_c	a	b	c	d
8	33	404	213.6667	8	64	248	107
8	33	404	213.6667	8	80	800	314
explain format=json select * from v1,t2 where (v1.a>6) and (t2.b>v1.b);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "(v1.a > 6)"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(t2.b > v1.b)",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.a > 6)"
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where 
((v1.a>7) and (t2.c<v1.max_c)) or ((v1.a<2) and (t2.b<v1.b));
a	b	max_c	avg_c	a	b	c	d
1	19	107	107.0000	2	3	207	207
1	19	107	107.0000	7	13	312	406
1	19	107	107.0000	3	12	231	190
1	21	500	234.6000	2	3	207	207
1	21	500	234.6000	7	13	312	406
1	21	500	234.6000	6	20	315	279
1	21	500	234.6000	1	19	203	107
1	21	500	234.6000	3	12	231	190
8	33	404	213.6667	2	3	207	207
8	33	404	213.6667	7	13	312	406
8	33	404	213.6667	8	64	248	107
8	33	404	213.6667	6	20	315	279
8	33	404	213.6667	1	19	203	107
8	33	404	213.6667	3	12	231	190
8	33	404	213.6667	6	23	303	909
explain format=json
select * from v1,t2 where 
((v1.a>7) and (t2.c<v1.max_c)) or ((v1.a<2) and (t2.b<v1.b));
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "((v1.a > 7) or (v1.a < 2))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(((v1.a > 7) and (t2.c < v1.max_c)) or ((v1.a < 2) and (t2.b < v1.b)))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((t1.a > 7) or (t1.a < 2))"
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where (v1.a<2) and (v1.max_c>400) and (t2.b>v1.b);
a	b	max_c	avg_c	a	b	c	d
1	21	500	234.6000	8	64	248	107
1	21	500	234.6000	8	80	800	314
1	21	500	234.6000	6	23	303	909
explain format=json 
select * from v1,t2 where (v1.a<2) and (v1.max_c>400) and (t2.b>v1.b);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "((v1.a < 2) and (v1.max_c > 400))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(t2.b > v1.b)",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and (max_c > 400))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.a < 2)"
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where 
((v1.a>7) and (v1.max_c>300) and (t2.c<v1.max_c)) or 
((v1.a<4) and (v1.max_c<500) and (t2.b<v1.b));
a	b	max_c	avg_c	a	b	c	d
1	19	107	107.0000	2	3	207	207
1	19	107	107.0000	7	13	312	406
1	19	107	107.0000	3	12	231	190
8	33	404	213.6667	2	3	207	207
8	33	404	213.6667	7	13	312	406
8	33	404	213.6667	8	64	248	107
8	33	404	213.6667	6	20	315	279
8	33	404	213.6667	1	19	203	107
8	33	404	213.6667	3	12	231	190
8	33	404	213.6667	6	23	303	909
explain format=json
select * from v1,t2 where 
((v1.a>7) and (v1.max_c>300) and (t2.c<v1.max_c)) or 
((v1.a<4) and (v1.max_c<500) and (t2.b<v1.b));
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "(((v1.a > 7) and (v1.max_c > 300)) or ((v1.a < 4) and (v1.max_c < 500)))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(((v1.a > 7) and (v1.max_c > 300) and (t2.c < v1.max_c)) or ((v1.a < 4) and (v1.max_c < 500) and (t2.b < v1.b)))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and (((t1.a > 7) and (max_c > 300)) or ((t1.a < 4) and (max_c < 500))))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((t1.a > 7) or (t1.a < 4))"
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where ((v1.a<2) and (v1.max_c>120)) or (v1.a>7);
a	b	max_c	avg_c	a	b	c	d
1	21	500	234.6000	2	3	207	207
1	21	500	234.6000	1	21	909	12
1	21	500	234.6000	7	13	312	406
1	21	500	234.6000	8	64	248	107
1	21	500	234.6000	6	20	315	279
1	21	500	234.6000	1	19	203	107
1	21	500	234.6000	8	80	800	314
1	21	500	234.6000	3	12	231	190
1	21	500	234.6000	6	23	303	909
8	33	404	213.6667	2	3	207	207
8	33	404	213.6667	1	21	909	12
8	33	404	213.6667	7	13	312	406
8	33	404	213.6667	8	64	248	107
8	33	404	213.6667	6	20	315	279
8	33	404	213.6667	1	19	203	107
8	33	404	213.6667	8	80	800	314
8	33	404	213.6667	3	12	231	190
8	33	404	213.6667	6	23	303	909
explain format=json 
select * from v1,t2 where ((v1.a<2) and (v1.max_c>120)) or (v1.a>7);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "(((v1.a < 2) and (v1.max_c > 120)) or (v1.a > 7))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(((v1.a < 2) and (v1.max_c > 120)) or (v1.a > 7))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and (((t1.a < 2) and (max_c > 120)) or (t1.a > 7)))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((t1.a < 2) or (t1.a > 7))"
              }
            }
          }
        }
      }
    }
  }
}
create view v2 as select a, b, max(c) as max_c, avg(c) as avg_c from t1 
where t1.a>5 group by a,b having max_c < 707;
select * from v2,t2 where (v2.b>25) and (t2.a<v2.a);
a	b	max_c	avg_c	a	b	c	d
8	33	404	213.6667	2	3	207	207
8	33	404	213.6667	1	21	909	12
8	33	404	213.6667	7	13	312	406
8	33	404	213.6667	6	20	315	279
8	33	404	213.6667	1	19	203	107
8	33	404	213.6667	3	12	231	190
8	33	404	213.6667	6	23	303	909
explain format=json select * from v2,t2 where (v2.b>25) and (t2.a<v2.a);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "(v2.b > 25)"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(t2.a < v2.a)",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((t1.a > 5) and (t1.b > 25))"
              }
            }
          }
        }
      }
    }
  }
}
select * from v2,t2 where 
((v2.a>7) and (t2.c<v2.max_c)) or ((v2.a>5) and (t2.b<v2.b));
a	b	max_c	avg_c	a	b	c	d
6	20	315	279.3333	2	3	207	207
6	20	315	279.3333	7	13	312	406
6	20	315	279.3333	1	19	203	107
6	20	315	279.3333	3	12	231	190
8	33	404	213.6667	2	3	207	207
8	33	404	213.6667	1	21	909	12
8	33	404	213.6667	7	13	312	406
8	33	404	213.6667	8	64	248	107
8	33	404	213.6667	6	20	315	279
8	33	404	213.6667	1	19	203	107
8	33	404	213.6667	3	12	231	190
8	33	404	213.6667	6	23	303	909
explain format=json 
select * from v2,t2 where 
((v2.a>7) and (t2.c<v2.max_c)) or ((v2.a>5) and (t2.b<v2.b));
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "((v2.a > 7) or (v2.a > 5))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(((v2.a > 7) and (t2.c < v2.max_c)) or ((v2.a > 5) and (t2.b < v2.b)))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((t1.a > 5) and ((t1.a > 7) or (t1.a > 5)))"
              }
            }
          }
        }
      }
    }
  }
}
prepare stmt from "select * from v1,t2 where 
  ((v1.max_c>400) and (t2.a>v1.a)) or ((v1.max_c<135) and (t2.a<v1.a));";
execute stmt;
a	b	max_c	avg_c	a	b	c	d
1	21	500	234.6000	2	3	207	207
1	21	500	234.6000	7	13	312	406
1	21	500	234.6000	8	64	248	107
1	21	500	234.6000	6	20	315	279
1	21	500	234.6000	8	80	800	314
1	21	500	234.6000	3	12	231	190
1	21	500	234.6000	6	23	303	909
5	27	132	132.0000	2	3	207	207
5	27	132	132.0000	1	21	909	12
5	27	132	132.0000	1	19	203	107
5	27	132	132.0000	3	12	231	190
execute stmt;
a	b	max_c	avg_c	a	b	c	d
1	21	500	234.6000	2	3	207	207
5	27	132	132.0000	2	3	207	207
5	27	132	132.0000	1	21	909	12
1	21	500	234.6000	7	13	312	406
1	21	500	234.6000	8	64	248	107
1	21	500	234.6000	6	20	315	279
5	27	132	132.0000	1	19	203	107
1	21	500	234.6000	8	80	800	314
1	21	500	234.6000	3	12	231	190
5	27	132	132.0000	3	12	231	190
1	21	500	234.6000	6	23	303	909
deallocate prepare stmt;
prepare stmt from 
"explain format=json select * from v1,t2 where 
    ((v1.max_c>400) and (t2.a>v1.a)) or ((v1.max_c<135) and (t2.a<v1.a));";
execute stmt;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "((v1.max_c > 400) or (v1.max_c < 135))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(((v1.max_c > 400) and (t2.a > v1.a)) or ((v1.max_c < 135) and (t2.a < v1.a)))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and ((max_c > 400) or (max_c < 135)))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              }
            }
          }
        }
      }
    }
  }
}
execute stmt;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "((v1.max_c > 400) or (v1.max_c < 135))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(((v1.max_c > 400) and (t2.a > v1.a)) or ((v1.max_c < 135) and (t2.a < v1.a)))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and ((max_c > 400) or (max_c < 135)))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              }
            }
          }
        }
      }
    }
  }
}
deallocate prepare stmt;
select * from v1,t2 where (t2.a<5) and (v1.a=t2.a);
a	b	max_c	avg_c	a	b	c	d
1	21	500	234.6000	1	21	909	12
1	19	107	107.0000	1	21	909	12
1	21	500	234.6000	1	19	203	107
1	19	107	107.0000	1	19	203	107
explain format=json select * from v1,t2 where (t2.a<5) and (v1.a=t2.a);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "((t2.a < 5) and (t2.a is not null))"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["a"],
      "ref": ["test.t2.a"],
      "rows": 2,
      "filtered": 100,
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.a < 5)"
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where (t2.c>150) and (v1.max_c=t2.c);
a	b	max_c	avg_c	a	b	c	d
5	16	207	207.0000	2	3	207	207
6	20	315	279.3333	6	20	315	279
explain format=json select * from v1,t2 where (t2.c>150) and (v1.max_c=t2.c);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "((t2.c > 150) and (t2.c is not null))"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["max_c"],
      "ref": ["test.t2.c"],
      "rows": 2,
      "filtered": 100,
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and (max_c > 150))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2
where ((t2.a>5) and (v1.a=t2.a)) and ((t2.c>250) and (v1.max_c=t2.c));
a	b	max_c	avg_c	a	b	c	d
6	20	315	279.3333	6	20	315	279
explain format=json
select * from v1,t2
where ((t2.a>5) and (v1.a=t2.a)) and ((t2.c>250) and (v1.max_c=t2.c));
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "((t2.a > 5) and (t2.c > 250) and (t2.a is not null) and (t2.c is not null))"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "10",
      "used_key_parts": ["a", "max_c"],
      "ref": ["test.t2.a", "test.t2.c"],
      "rows": 2,
      "filtered": 100,
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and (max_c > 250))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.a > 5)"
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2
where ((t2.a<4) and (v1.a=t2.a)) or ((t2.c>150) and (v1.max_c=t2.c));
a	b	max_c	avg_c	a	b	c	d
1	19	107	107.0000	1	21	909	12
1	19	107	107.0000	1	19	203	107
1	21	500	234.6000	1	21	909	12
1	21	500	234.6000	1	19	203	107
5	16	207	207.0000	2	3	207	207
6	20	315	279.3333	6	20	315	279
explain format=json
select * from v1,t2
where ((t2.a<4) and (v1.a=t2.a)) or ((t2.c>150) and (v1.max_c=t2.c));
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "((t2.a < 4) or (t2.c > 150))"
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(((v1.a = t2.a) and (t2.a < 4)) or ((v1.max_c = t2.c) and (t2.c > 150)))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and ((t1.a < 4) or (max_c > 150)))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where
((v1.max_c>300) and (v1.avg_c>t2.d) and (v1.b=t2.b)) or 
((v1.max_c<135) and (v1.max_c<t2.c) and (v1.a=t2.a));
a	b	max_c	avg_c	a	b	c	d
1	19	107	107.0000	1	21	909	12
1	19	107	107.0000	1	19	203	107
1	21	500	234.6000	1	21	909	12
6	20	315	279.3333	6	20	315	279
explain format=json
select * from v1,t2 where
((v1.max_c>300) and (v1.avg_c>t2.d) and (v1.b=t2.b)) or 
((v1.max_c<135) and (v1.max_c<t2.c) and (v1.a=t2.a));
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "((v1.max_c > 300) or (v1.max_c < 135))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(((v1.b = t2.b) and (v1.max_c > 300) and (v1.avg_c > t2.d)) or ((v1.a = t2.a) and (v1.max_c < 135) and (v1.max_c < t2.c)))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and ((max_c > 300) or (max_c < 135)))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where 
((v1.a>4) and (v1.b>t2.b) and (v1.max_c=t2.d)) or 
((v1.a<2) and (v1.max_c<t2.c) and (v1.max_c=t2.d));
a	b	max_c	avg_c	a	b	c	d
1	19	107	107.0000	8	64	248	107
1	19	107	107.0000	1	19	203	107
5	16	207	207.0000	2	3	207	207
explain format=json
select * from v1,t2 where 
((v1.a>4) and (v1.b>t2.b) and (v1.max_c=t2.d)) or 
((v1.a<2) and (v1.max_c<t2.c) and (v1.max_c=t2.d));
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "((v1.a > 4) or (v1.a < 2))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(((v1.a > 4) and (v1.b > t2.b) and (v1.max_c = t2.d)) or ((v1.a < 2) and (v1.max_c < t2.c) and (v1.max_c = t2.d)))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((t1.a > 4) or (t1.a < 2))"
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where 
(v1.a>3) and (v1.max_c>200) and (t2.b<v1.b) and (t2.d=v1.max_c);
a	b	max_c	avg_c	a	b	c	d
5	16	207	207.0000	2	3	207	207
explain format=json
select * from v1,t2 where 
(v1.a>3) and (v1.max_c>200) and (t2.b<v1.b) and (t2.d=v1.max_c);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "(t2.d is not null)"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["max_c"],
      "ref": ["test.t2.d"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "((v1.a > 3) and (v1.max_c > 200) and (t2.b < v1.b) and (t2.d = v1.max_c))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and (max_c > 200))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.a > 3)"
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where 
((v1.a<2) and (v1.max_c>120) and (v1.b=t2.b)) or (v1.a>7);
a	b	max_c	avg_c	a	b	c	d
1	21	500	234.6000	1	21	909	12
8	33	404	213.6667	2	3	207	207
8	33	404	213.6667	1	21	909	12
8	33	404	213.6667	7	13	312	406
8	33	404	213.6667	8	64	248	107
8	33	404	213.6667	6	20	315	279
8	33	404	213.6667	1	19	203	107
8	33	404	213.6667	8	80	800	314
8	33	404	213.6667	3	12	231	190
8	33	404	213.6667	6	23	303	909
explain format=json
select * from v1,t2 where 
((v1.a<2) and (v1.max_c>120) and (v1.b=t2.b)) or (v1.a>7);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "(((v1.a < 2) and (v1.max_c > 120)) or (v1.a > 7))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(((v1.b = t2.b) and (v1.a < 2) and (v1.max_c > 120)) or (v1.a > 7))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and (((t1.a < 2) and (max_c > 120)) or (t1.a > 7)))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((t1.a < 2) or (t1.a > 7))"
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where
((v1.a<2) and (v1.max_c<200) and (t2.c>v1.max_c) and (v1.max_c=t2.d)) or
((v1.a>4) and (v1.max_c<500) and (t2.b<v1.b) and (v1.max_c=t2.c));
a	b	max_c	avg_c	a	b	c	d
1	19	107	107.0000	8	64	248	107
1	19	107	107.0000	1	19	203	107
5	16	207	207.0000	2	3	207	207
explain format=json
select * from v1,t2 where
((v1.a<2) and (v1.max_c<200) and (t2.c>v1.max_c) and (v1.max_c=t2.d)) or
((v1.a>4) and (v1.max_c<500) and (t2.b<v1.b) and (v1.max_c=t2.c));
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "(((v1.a < 2) and (v1.max_c < 200)) or (v1.a > 4))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(((v1.a < 2) and (v1.max_c < 200) and (t2.c > v1.max_c) and (v1.max_c = t2.d)) or ((v1.max_c = t2.c) and (v1.a > 4) and (t2.c < 500) and (t2.b < v1.b)))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and (((t1.a < 2) and (max_c < 200)) or ((t1.a > 4) and (max_c < 500))))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((t1.a < 2) or (t1.a > 4))"
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where (t2.a<2) and (t2.c>900);
a	b	max_c	avg_c	a	b	c	d
1	19	107	107.0000	1	21	909	12
1	21	500	234.6000	1	21	909	12
5	16	207	207.0000	1	21	909	12
5	27	132	132.0000	1	21	909	12
6	20	315	279.3333	1	21	909	12
8	33	404	213.6667	1	21	909	12
explain format=json 
select * from v1,t2 where (t2.a<2) and (t2.c>900);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "((t2.a < 2) and (t2.c > 900))"
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where 
(t2.a<2) and (t2.c>900) and ((v1.a<t2.a) or (t2.a<11));
a	b	max_c	avg_c	a	b	c	d
1	19	107	107.0000	1	21	909	12
1	21	500	234.6000	1	21	909	12
5	16	207	207.0000	1	21	909	12
5	27	132	132.0000	1	21	909	12
6	20	315	279.3333	1	21	909	12
8	33	404	213.6667	1	21	909	12
explain format=json 
select * from v1,t2 where 
(t2.a<2) and (t2.c>900) and ((v1.a<t2.a) or (t2.a<11));
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "((t2.a < 2) and (t2.c > 900))"
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "((v1.a < t2.a) or (t2.a < 11))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where (v1.a=t2.a) and (v1.b=t2.b);
a	b	max_c	avg_c	a	b	c	d
1	21	500	234.6000	1	21	909	12
6	20	315	279.3333	6	20	315	279
1	19	107	107.0000	1	19	203	107
explain format=json select * from v1,t2 where (v1.a=t2.a) and (v1.b=t2.b);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "((t2.a is not null) and (t2.b is not null))"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "10",
      "used_key_parts": ["a", "b"],
      "ref": ["test.t2.a", "test.t2.b"],
      "rows": 2,
      "filtered": 100,
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where (t2.a=v1.a) and (v1.b=t2.b) and (v1.a=1);
a	b	max_c	avg_c	a	b	c	d
1	21	500	234.6000	1	21	909	12
1	19	107	107.0000	1	19	203	107
explain format=json 
select * from v1,t2 where (t2.a=v1.a) and (v1.b=t2.b) and (v1.a=1);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "((t2.a = 1) and (t2.b is not null))"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["b"],
      "ref": ["test.t2.b"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "(v1.a = 1)",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.a = 1)"
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where 
(t2.a=v1.a) or (v1.b=t2.b) and ((v1.a=1) or (v1.a=6));
a	b	max_c	avg_c	a	b	c	d
1	19	107	107.0000	1	21	909	12
1	19	107	107.0000	1	19	203	107
1	21	500	234.6000	1	21	909	12
1	21	500	234.6000	1	19	203	107
6	20	315	279.3333	6	20	315	279
6	20	315	279.3333	6	23	303	909
8	33	404	213.6667	8	64	248	107
8	33	404	213.6667	8	80	800	314
explain format=json  
select * from v1,t2 where 
(t2.a=v1.a) or (v1.b=t2.b) and ((v1.a=1) or (v1.a=6));
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "((v1.a = t2.a) or ((v1.b = t2.b) and ((v1.a = 1) or (v1.a = 6))))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where (v1.a=5) and (v1.max_c=t2.d);
a	b	max_c	avg_c	a	b	c	d
5	16	207	207.0000	2	3	207	207
explain format=json select * from v1,t2 where (v1.a=5) and (v1.max_c=t2.d);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "(t2.d is not null)"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["max_c"],
      "ref": ["test.t2.d"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "((v1.a = 5) and (v1.max_c = t2.d))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.a = 5)"
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where (v1.a=1) and (v1.b=21) and (t2.a=2);
a	b	max_c	avg_c	a	b	c	d
1	21	500	234.6000	2	3	207	207
explain format=json 
select * from v1,t2 where (v1.a=1) and (v1.b=21) and (t2.a=2);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "(t2.a = 2)"
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "((v1.a = 1) and (v1.b = 21))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "table": {
            "table_name": "t1",
            "access_type": "ALL",
            "rows": 20,
            "filtered": 100,
            "attached_condition": "((t1.a = 1) and (t1.b = 21))"
          }
        }
      }
    }
  }
}
select * from v1,t2 where (v1.a=1) or (v1.b=21) or (t2.a=2);
a	b	max_c	avg_c	a	b	c	d
1	19	107	107.0000	2	3	207	207
1	19	107	107.0000	1	21	909	12
1	19	107	107.0000	7	13	312	406
1	19	107	107.0000	8	64	248	107
1	19	107	107.0000	6	20	315	279
1	19	107	107.0000	1	19	203	107
1	19	107	107.0000	8	80	800	314
1	19	107	107.0000	3	12	231	190
1	19	107	107.0000	6	23	303	909
1	21	500	234.6000	2	3	207	207
1	21	500	234.6000	1	21	909	12
1	21	500	234.6000	7	13	312	406
1	21	500	234.6000	8	64	248	107
1	21	500	234.6000	6	20	315	279
1	21	500	234.6000	1	19	203	107
1	21	500	234.6000	8	80	800	314
1	21	500	234.6000	3	12	231	190
1	21	500	234.6000	6	23	303	909
5	16	207	207.0000	2	3	207	207
5	27	132	132.0000	2	3	207	207
6	20	315	279.3333	2	3	207	207
8	33	404	213.6667	2	3	207	207
explain format=json 
select * from v1,t2 where (v1.a=1) or (v1.b=21) or (t2.a=2);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "((v1.a = 1) or (v1.b = 21) or (t2.a = 2))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where (v1.a=1) or (v1.b=21) and (t2.a=2);
a	b	max_c	avg_c	a	b	c	d
1	19	107	107.0000	2	3	207	207
1	19	107	107.0000	1	21	909	12
1	19	107	107.0000	7	13	312	406
1	19	107	107.0000	8	64	248	107
1	19	107	107.0000	6	20	315	279
1	19	107	107.0000	1	19	203	107
1	19	107	107.0000	8	80	800	314
1	19	107	107.0000	3	12	231	190
1	19	107	107.0000	6	23	303	909
1	21	500	234.6000	2	3	207	207
1	21	500	234.6000	1	21	909	12
1	21	500	234.6000	7	13	312	406
1	21	500	234.6000	8	64	248	107
1	21	500	234.6000	6	20	315	279
1	21	500	234.6000	1	19	203	107
1	21	500	234.6000	8	80	800	314
1	21	500	234.6000	3	12	231	190
1	21	500	234.6000	6	23	303	909
explain format=json 
select * from v1,t2 where (v1.a=1) or (v1.b=21) and (t2.a=2);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "((v1.a = 1) or (v1.b = 21))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "((v1.a = 1) or ((v1.b = 21) and (t2.a = 2)))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((t1.a = 1) or (t1.b = 21))"
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where (v1.a=v1.b) and (v1.a=t2.a);
a	b	max_c	avg_c	a	b	c	d
explain format=json 
select * from v1,t2 where (v1.a=v1.b) and (v1.a=t2.a);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "((t2.a is not null) and (t2.a is not null))"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "10",
      "used_key_parts": ["a", "b"],
      "ref": ["test.t2.a", "test.t2.a"],
      "rows": 2,
      "filtered": 100,
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.b = t1.a)"
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where (v1.a=v1.b) and (v1.a=t2.a) and (v1.a=3);
a	b	max_c	avg_c	a	b	c	d
explain format=json 
select * from v1,t2 where (v1.a=v1.b) and (v1.a=t2.a) and (v1.a=3);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "(t2.a = 3)"
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "((v1.a = 3) and (v1.b = 3))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "table": {
            "table_name": "t1",
            "access_type": "ALL",
            "rows": 20,
            "filtered": 100,
            "attached_condition": "((t1.a = 3) and (t1.b = 3))"
          }
        }
      }
    }
  }
}
select * from v1,v2,t2 where (v1.a=v2.a) and (v1.a=t2.a) and (v2.b<50);
a	b	max_c	avg_c	a	b	max_c	avg_c	a	b	c	d
8	33	404	213.6667	8	33	404	213.6667	8	64	248	107
6	20	315	279.3333	6	20	315	279.3333	6	20	315	279
8	33	404	213.6667	8	33	404	213.6667	8	80	800	314
6	20	315	279.3333	6	20	315	279.3333	6	23	303	909
explain format=json select * from v1,v2,t2 where 
(v1.a=v2.a) and (v1.a=t2.a) and (v2.b<50);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "((t2.a is not null) and (t2.a is not null))"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key1"],
      "key": "key1",
      "key_length": "5",
      "used_key_parts": ["a"],
      "ref": ["test.t2.a"],
      "rows": 2,
      "filtered": 100,
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              }
            }
          }
        }
      }
    },
    "table": {
      "table_name": "<derived3>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["a"],
      "ref": ["test.t2.a"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "(v2.b < 50)",
      "materialized": {
        "query_block": {
          "select_id": 3,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((t1.a > 5) and (t1.b < 50))"
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,v2,t2 where 
((v1.a=v2.a) or (v1.a=t2.a)) and (t2.b<50) and (v1.b=v2.b);
a	b	max_c	avg_c	a	b	max_c	avg_c	a	b	c	d
6	20	315	279.3333	6	20	315	279.3333	2	3	207	207
6	20	315	279.3333	6	20	315	279.3333	1	21	909	12
6	20	315	279.3333	6	20	315	279.3333	7	13	312	406
6	20	315	279.3333	6	20	315	279.3333	6	20	315	279
6	20	315	279.3333	6	20	315	279.3333	1	19	203	107
6	20	315	279.3333	6	20	315	279.3333	3	12	231	190
6	20	315	279.3333	6	20	315	279.3333	6	23	303	909
8	33	404	213.6667	8	33	404	213.6667	2	3	207	207
8	33	404	213.6667	8	33	404	213.6667	1	21	909	12
8	33	404	213.6667	8	33	404	213.6667	7	13	312	406
8	33	404	213.6667	8	33	404	213.6667	6	20	315	279
8	33	404	213.6667	8	33	404	213.6667	1	19	203	107
8	33	404	213.6667	8	33	404	213.6667	3	12	231	190
8	33	404	213.6667	8	33	404	213.6667	6	23	303	909
explain format=json 
select * from v1,v2,t2 where 
((v1.a=v2.a) or (v1.a=t2.a)) and (t2.b<50) and (v1.b=v2.b);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "(t2.b < 50)"
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(v1.b is not null)",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              }
            }
          }
        }
      }
    },
    "table": {
      "table_name": "<derived3>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["b"],
      "ref": ["v1.b"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "((v2.a = v1.a) or (v1.a = t2.a))",
      "materialized": {
        "query_block": {
          "select_id": 3,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.a > 5)"
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,v2,t2 where ((v1.a=v2.a) or (v1.a=t2.a)) and 
((v2.b<50) or (v2.b=19)) and (v1.max_c<300);
a	b	max_c	avg_c	a	b	max_c	avg_c	a	b	c	d
1	19	107	107.0000	6	20	315	279.3333	1	21	909	12
1	19	107	107.0000	6	20	315	279.3333	1	19	203	107
1	19	107	107.0000	8	33	404	213.6667	1	21	909	12
1	19	107	107.0000	8	33	404	213.6667	1	19	203	107
explain format=json 
select * from v1,v2,t2 where ((v1.a=v2.a) or (v1.a=t2.a)) and 
((v2.b<50) or (v2.b=19)) and (v1.max_c<300);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "(v1.max_c < 300)"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and (max_c < 300))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              }
            }
          }
        }
      }
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived3>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "((v2.b < 50) or (v2.b = 19))"
      },
      "buffer_type": "incremental",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(((v2.a = v1.a) or (v1.a = t2.a)) and ((v2.b < 50) or (v2.b = 19)))",
      "materialized": {
        "query_block": {
          "select_id": 3,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((t1.a > 5) and ((t1.b < 50) or (t1.b = 19)))"
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,v2,t2 where 
((v1.a=v2.a) and (v1.a=t2.a)) or ((v2.b>13) and (t2.c<115));
a	b	max_c	avg_c	a	b	max_c	avg_c	a	b	c	d
6	20	315	279.3333	6	20	315	279.3333	6	20	315	279
6	20	315	279.3333	6	20	315	279.3333	6	23	303	909
8	33	404	213.6667	8	33	404	213.6667	8	64	248	107
8	33	404	213.6667	8	33	404	213.6667	8	80	800	314
explain format=json 
select * from v1,v2,t2 where 
((v1.a=v2.a) and (v1.a=t2.a)) or ((v2.b>13) and (t2.c<115));
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "((v1.a = t2.a) or (t2.c < 115))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              }
            }
          }
        }
      }
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived3>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100
      },
      "buffer_type": "incremental",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(((v1.a = t2.a) and (v2.a = t2.a)) or ((v2.b > 13) and (t2.c < 115)))",
      "materialized": {
        "query_block": {
          "select_id": 3,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.a > 5)"
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,v2,t2 where 
(v1.a=t2.a) and (v1.a=v1.b) and (v1.a=v2.a) and (v2.max_c<300);
a	b	max_c	avg_c	a	b	max_c	avg_c	a	b	c	d
explain format=json 
select * from v1,v2,t2 where 
(v1.a=t2.a) and (v1.a=v1.b) and (v1.a=v2.a) and (v2.max_c<300);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "((t2.a is not null) and (t2.a is not null) and (t2.a is not null))"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key1"],
      "key": "key1",
      "key_length": "10",
      "used_key_parts": ["a", "b"],
      "ref": ["test.t2.a", "test.t2.a"],
      "rows": 2,
      "filtered": 100,
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.b = t1.a)"
              }
            }
          }
        }
      }
    },
    "table": {
      "table_name": "<derived3>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["a"],
      "ref": ["test.t2.a"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "(v2.max_c < 300)",
      "materialized": {
        "query_block": {
          "select_id": 3,
          "having_condition": "((max_c < 707) and (max_c < 300))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.a > 5)"
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,v2,t2 where (v1.a=8) and (v1.b>10) and (v1.b=v2.b);
a	b	max_c	avg_c	a	b	max_c	avg_c	a	b	c	d
8	33	404	213.6667	8	33	404	213.6667	2	3	207	207
8	33	404	213.6667	8	33	404	213.6667	1	21	909	12
8	33	404	213.6667	8	33	404	213.6667	7	13	312	406
8	33	404	213.6667	8	33	404	213.6667	8	64	248	107
8	33	404	213.6667	8	33	404	213.6667	6	20	315	279
8	33	404	213.6667	8	33	404	213.6667	1	19	203	107
8	33	404	213.6667	8	33	404	213.6667	8	80	800	314
8	33	404	213.6667	8	33	404	213.6667	3	12	231	190
8	33	404	213.6667	8	33	404	213.6667	6	23	303	909
explain format=json 
select * from v1,v2,t2 where (v1.a=1) and (v1.b>10) and (v1.b=v2.b);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "((v1.a = 1) and (v1.b > 10))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(v1.b is not null)",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((t1.a = 1) and (t1.b > 10))"
              }
            }
          }
        }
      }
    },
    "table": {
      "table_name": "<derived3>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["b"],
      "ref": ["v1.b"],
      "rows": 2,
      "filtered": 100,
      "materialized": {
        "query_block": {
          "select_id": 3,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((t1.a > 5) and (t1.b > 10))"
              }
            }
          }
        }
      }
    }
  }
}
create view v3 as select a, b, min(c) as min_c from t1
where t1.a<10 group by a,b having min_c > 109;
select * from v1,v2,v3,t2 where 
((v1.a=v2.a) or (v1.a=t2.a)) and ((v3.b<50) or (v3.b=33)) 
and (v1.max_c<500) and (v3.a=t2.a) and (v2.max_c>300);
a	b	max_c	avg_c	a	b	max_c	avg_c	a	b	min_c	a	b	c	d
6	20	315	279.3333	6	20	315	279.3333	7	11	708	7	13	312	406
6	20	315	279.3333	6	20	315	279.3333	8	33	114	8	64	248	107
6	20	315	279.3333	6	20	315	279.3333	6	20	214	6	20	315	279
6	20	315	279.3333	6	20	315	279.3333	8	33	114	8	80	800	314
6	20	315	279.3333	6	20	315	279.3333	6	20	214	6	23	303	909
6	20	315	279.3333	8	33	404	213.6667	6	20	214	6	20	315	279
6	20	315	279.3333	8	33	404	213.6667	6	20	214	6	23	303	909
8	33	404	213.6667	6	20	315	279.3333	8	33	114	8	64	248	107
8	33	404	213.6667	6	20	315	279.3333	8	33	114	8	80	800	314
8	33	404	213.6667	8	33	404	213.6667	7	11	708	7	13	312	406
8	33	404	213.6667	8	33	404	213.6667	8	33	114	8	64	248	107
8	33	404	213.6667	8	33	404	213.6667	6	20	214	6	20	315	279
8	33	404	213.6667	8	33	404	213.6667	8	33	114	8	80	800	314
8	33	404	213.6667	8	33	404	213.6667	6	20	214	6	23	303	909
explain format=json 
select * from v1,v2,v3,t2 where 
((v1.a=v2.a) or (v1.a=t2.a)) and ((v3.b<50) or (v3.b=33)) 
and (v1.max_c<500) and (v3.a=t2.a) and (v2.max_c>300);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "(t2.a is not null)"
    },
    "table": {
      "table_name": "<derived4>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["a"],
      "ref": ["test.t2.a"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "((v3.b < 50) or (v3.b = 33))",
      "materialized": {
        "query_block": {
          "select_id": 4,
          "having_condition": "(min_c > 109)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((t1.a < 10) and ((t1.b < 50) or (t1.b = 33)))"
              }
            }
          }
        }
      }
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived3>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "(v2.max_c > 300)"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "materialized": {
        "query_block": {
          "select_id": 3,
          "having_condition": "((max_c < 707) and (max_c > 300))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.a > 5)"
              }
            }
          }
        }
      }
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "(v1.max_c < 500)"
      },
      "buffer_type": "incremental",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "((v1.a = v2.a) or (v1.a = t2.a))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and (max_c < 500))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              }
            }
          }
        }
      }
    }
  }
}
select * from
(select a, b, max(c) as max_c, avg(c) as avg_c from t1
group by a,b having max_c < 707) v1, 
t2 where (v1.a=t2.a) and (v1.max_c>300);
a	b	max_c	avg_c	a	b	c	d
1	21	500	234.6000	1	21	909	12
8	33	404	213.6667	8	64	248	107
6	20	315	279.3333	6	20	315	279
1	21	500	234.6000	1	19	203	107
8	33	404	213.6667	8	80	800	314
6	20	315	279.3333	6	23	303	909
explain format=json
select * from
(select a, b, max(c) as max_c, avg(c) as avg_c from t1
group by a,b having max_c < 707) v1, 
t2 where (v1.a=t2.a) and (v1.max_c>300);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "(t2.a is not null)"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["a"],
      "ref": ["test.t2.a"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "(v1.max_c > 300)",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and (max_c > 300))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              }
            }
          }
        }
      }
    }
  }
}
select * from
(select a, b, max(c) as max_c, avg(c) as avg_c from t1
group by a,b having max_c < 707) v1, 
t2 where ((v1.a=1) or (v1.max_c<300)) and (v1.b>25);
a	b	max_c	avg_c	a	b	c	d
5	27	132	132.0000	2	3	207	207
5	27	132	132.0000	1	21	909	12
5	27	132	132.0000	7	13	312	406
5	27	132	132.0000	8	64	248	107
5	27	132	132.0000	6	20	315	279
5	27	132	132.0000	1	19	203	107
5	27	132	132.0000	8	80	800	314
5	27	132	132.0000	3	12	231	190
5	27	132	132.0000	6	23	303	909
explain format=json
select * from
(select a, b, max(c) as max_c, avg(c) as avg_c from t1
group by a,b having max_c < 707) v1, 
t2 where ((v1.a=1) or (v1.max_c<300)) and (v1.b>25);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "(((v1.a = 1) or (v1.max_c < 300)) and (v1.b > 25))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "((v1.a = 1) or (v1.max_c < 300))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and ((t1.a = 1) or (max_c < 300)))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.b > 25)"
              }
            }
          }
        }
      }
    }
  }
}
select * from
(select a, b, max(c) as max_c, avg(c) as avg_c from t1
group by a,b having max_c < 707) v1, 
t2 where ((v1.max_c>300) and (v1.avg_c>t2.d) and (v1.b=t2.b)) or 
((v1.max_c<135) and (v1.max_c<t2.c) and (v1.a=t2.a));
a	b	max_c	avg_c	a	b	c	d
1	19	107	107.0000	1	21	909	12
1	19	107	107.0000	1	19	203	107
1	21	500	234.6000	1	21	909	12
6	20	315	279.3333	6	20	315	279
explain format=json
select * from
(select a, b, max(c) as max_c, avg(c) as avg_c from t1
group by a,b having max_c < 707) v1, 
t2 where ((v1.max_c>300) and (v1.avg_c>t2.d) and (v1.b=t2.b)) or 
((v1.max_c<135) and (v1.max_c<t2.c) and (v1.a=t2.a));
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "((v1.max_c > 300) or (v1.max_c < 135))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(((v1.b = t2.b) and (v1.max_c > 300) and (v1.avg_c > t2.d)) or ((v1.a = t2.a) and (v1.max_c < 135) and (v1.max_c < t2.c)))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and ((max_c > 300) or (max_c < 135)))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              }
            }
          }
        }
      }
    }
  }
}
select * from
(select a, b, max(c) as max_c, avg(c) as avg_c from t1
group by a,b having max_c < 707) v1, 
t2 where (v1.a=8) and (v1.a=t2.a) and (v1.max_c=404);
a	b	max_c	avg_c	a	b	c	d
8	33	404	213.6667	8	64	248	107
8	33	404	213.6667	8	80	800	314
explain format=json
select * from
(select a, b, max(c) as max_c, avg(c) as avg_c from t1
group by a,b having max_c < 707) v1, 
t2 where (v1.a=8) and (v1.a=t2.a) and (v1.max_c=404);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "(t2.a = 8)"
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "((v1.a = 8) and (v1.max_c = 404))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and (max_c = 404))",
          "filesort": {
            "sort_key": "t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.a = 8)"
              }
            }
          }
        }
      }
    }
  }
}
select * from
(select a, b, max(c) as max_c, avg(c) as avg_c from t1
where t1.a>5 group by a,b having max_c < 707) v1, 
t2 where (v1.a=t2.a) and (v1.max_c>300) and (v1.b<30);
a	b	max_c	avg_c	a	b	c	d
6	20	315	279.3333	6	20	315	279
6	20	315	279.3333	6	23	303	909
explain format=json
select * from
(select a, b, max(c) as max_c, avg(c) as avg_c from t1
where t1.a>5 group by a,b having max_c < 707) v1, 
t2 where (v1.a=t2.a) and (v1.max_c>300) and (v1.b<30);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "(t2.a is not null)"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["a"],
      "ref": ["test.t2.a"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "((v1.max_c > 300) and (v1.b < 30))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and (max_c > 300))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((t1.a > 5) and (t1.b < 30))"
              }
            }
          }
        }
      }
    }
  }
}
select * from
(select a, b, max(c) as max_c, avg(c) as avg_c from t1
where t1.a>5 group by a,b having max_c < 707) v1, 
t2 where (v1.a=t2.a) and (v1.max_c>300) and (v1.a=v1.b);
a	b	max_c	avg_c	a	b	c	d
explain format=json
select * from
(select a, b, max(c) as max_c, avg(c) as avg_c from t1
where t1.a>5 group by a,b having max_c < 707) v1, 
t2 where (v1.a=t2.a) and (v1.max_c>300) and (v1.a=v1.b);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "((t2.a is not null) and (t2.a is not null))"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "10",
      "used_key_parts": ["a", "b"],
      "ref": ["test.t2.a", "test.t2.a"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "(v1.max_c > 300)",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and (max_c > 300))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((t1.b = t1.a) and (t1.a > 5))"
              }
            }
          }
        }
      }
    }
  }
}
select * from
(select a, b, max(c) as max_c, avg(c) as avg_c from t1
where t1.a>5 group by a,b having max_c < 707) v1,
(select a, b, min(c) as min_c from t1
where t1.a>5 group by a,b having min_c < 707) v2,
t2 where (v1.a=v2.a) and (v1.b=t2.b) and (max_c>min_c);
a	b	max_c	avg_c	a	b	min_c	a	b	c	d
6	20	315	279.3333	6	20	214	6	20	315	279
explain format=json
select * from
(select a, b, max(c) as max_c, avg(c) as avg_c from t1
where t1.a>5 group by a,b having max_c < 707) v1,
(select a, b, min(c) as min_c from t1
where t1.a>5 group by a,b having min_c < 707) v2,
t2 where (v1.a=v2.a) and (v1.b=t2.b) and (v1.max_c>130) and (v2.min_c<130);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "(t2.b is not null)"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key1"],
      "key": "key1",
      "key_length": "5",
      "used_key_parts": ["b"],
      "ref": ["test.t2.b"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "((v1.max_c > 130) and (v1.a is not null))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and (max_c > 130))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.a > 5)"
              }
            }
          }
        }
      }
    },
    "table": {
      "table_name": "<derived3>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["a"],
      "ref": ["v1.a"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "(v2.min_c < 130)",
      "materialized": {
        "query_block": {
          "select_id": 3,
          "having_condition": "((min_c < 707) and (min_c < 130))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.a > 5)"
              }
            }
          }
        }
      }
    }
  }
}
select * from
(select a, b, max(c) as max_c, avg(c) as avg_c from t1
where t1.a>5 group by a,b having max_c < 707) v1,
(select a, b, min(c) as min_c from t1
where t1.a>5 group by a,b having min_c < 707) v2,
(select a, b, avg(c) as avg_c from t1
where t1.a<8 group by a,b) v3,
t2 where (v1.a=v2.a) and (v1.b=v3.b) and ((v3.avg_c>170) or (v3.a<5))
and ((v1.avg_c<400) or (v1.a>1)) and (v2.min_c<200);
a	b	max_c	avg_c	a	b	min_c	a	b	avg_c	a	b	c	d
8	33	404	213.6667	8	33	114	1	33	497.5000	2	3	207	207
8	33	404	213.6667	8	33	114	1	33	497.5000	1	21	909	12
8	33	404	213.6667	8	33	114	1	33	497.5000	7	13	312	406
8	33	404	213.6667	8	33	114	1	33	497.5000	8	64	248	107
8	33	404	213.6667	8	33	114	1	33	497.5000	6	20	315	279
8	33	404	213.6667	8	33	114	1	33	497.5000	1	19	203	107
8	33	404	213.6667	8	33	114	1	33	497.5000	8	80	800	314
8	33	404	213.6667	8	33	114	1	33	497.5000	3	12	231	190
8	33	404	213.6667	8	33	114	1	33	497.5000	6	23	303	909
explain format=json
select * from
(select a, b, max(c) as max_c, avg(c) as avg_c from t1
where t1.a>5 group by a,b having max_c < 707) v1,
(select a, b, min(c) as min_c from t1
where t1.a>5 group by a,b having min_c < 707) v2,
(select a, b, avg(c) as avg_c from t1
where t1.a<8 group by a,b) v3,
t2 where (v1.a=v2.a) and (v1.b=v3.b) and ((v3.avg_c>170) or (v3.a<5))
and ((v1.avg_c<400) or (v1.a>1)) and (v2.min_c<200);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "((v1.avg_c < 400) or (v1.a > 1))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "(((v1.avg_c < 400) or (v1.a > 1)) and (v1.a is not null) and (v1.b is not null))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and ((avg_c < 400) or (t1.a > 1)))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.a > 5)"
              }
            }
          }
        }
      }
    },
    "table": {
      "table_name": "<derived3>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["a"],
      "ref": ["v1.a"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "(v2.min_c < 200)",
      "materialized": {
        "query_block": {
          "select_id": 3,
          "having_condition": "((min_c < 707) and (min_c < 200))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.a > 5)"
              }
            }
          }
        }
      }
    },
    "table": {
      "table_name": "<derived4>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["b"],
      "ref": ["v1.b"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "((v3.avg_c > 170) or (v3.a < 5))",
      "materialized": {
        "query_block": {
          "select_id": 4,
          "having_condition": "((avg_c > 170) or (t1.a < 5))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.a < 8)"
              }
            }
          }
        }
      }
    }
  }
}
set optimizer_switch="condition_pushdown_for_derived=off";
select * from v1,t2 where (v1.a=t2.a) and (v1.b>2) and (v1.max_c>200);
a	b	max_c	avg_c	a	b	c	d
1	21	500	234.6000	1	21	909	12
8	33	404	213.6667	8	64	248	107
6	20	315	279.3333	6	20	315	279
1	21	500	234.6000	1	19	203	107
8	33	404	213.6667	8	80	800	314
6	20	315	279.3333	6	23	303	909
explain format=json 
select * from v1,t2 where (v1.a=t2.a) and (v1.b>2) and (v1.max_c>200);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "(t2.a is not null)"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["a"],
      "ref": ["test.t2.a"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "((v1.b > 2) and (v1.max_c > 200))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              }
            }
          }
        }
      }
    }
  }
}
set optimizer_switch="condition_pushdown_for_derived=on";
select * from v1,t2 where (v1.a=t2.a) and (v1.b>2) and (v1.max_c>200);
a	b	max_c	avg_c	a	b	c	d
1	21	500	234.6000	1	21	909	12
8	33	404	213.6667	8	64	248	107
6	20	315	279.3333	6	20	315	279
1	21	500	234.6000	1	19	203	107
8	33	404	213.6667	8	80	800	314
6	20	315	279.3333	6	23	303	909
explain format=json 
select * from v1,t2 where (v1.a=t2.a) and (v1.b>2) and (v1.max_c>200);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "(t2.a is not null)"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["a"],
      "ref": ["test.t2.a"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "((v1.b > 2) and (v1.max_c > 200))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 707) and (max_c > 200))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.b > 2)"
              }
            }
          }
        }
      }
    }
  }
}
select * from v1,t2 where (v1.a<2) and (v1.b=t2.b) and (t2.c>800)
union 
select * from v1,t2 where (v1.max_c>100) and (v1.a>7) and (t2.d>800);
a	b	max_c	avg_c	a	b	c	d
1	21	500	234.6000	1	21	909	12
8	33	404	213.6667	6	23	303	909
explain format=json 
select * from v1,t2 where (v1.a<5) and (v1.b=t2.b) and (t2.c>800)
union
select * from v1,t2 where (v1.max_c>100) and (v1.a>7) and (t2.d>800);
EXPLAIN
{
  "query_block": {
    "union_result": {
      "table_name": "<union1,2>",
      "access_type": "ALL",
      "query_specifications": [
        {
          "query_block": {
            "select_id": 1,
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 9,
              "filtered": 100,
              "attached_condition": "((t2.c > 800) and (t2.b is not null))"
            },
            "table": {
              "table_name": "<derived3>",
              "access_type": "ref",
              "possible_keys": ["key0"],
              "key": "key0",
              "key_length": "5",
              "used_key_parts": ["b"],
              "ref": ["test.t2.b"],
              "rows": 2,
              "filtered": 100,
              "attached_condition": "(v1.a < 5)",
              "materialized": {
                "query_block": {
                  "select_id": 3,
                  "having_condition": "(max_c < 707)",
                  "filesort": {
                    "sort_key": "t1.a, t1.b",
                    "temporary_table": {
                      "table": {
                        "table_name": "t1",
                        "access_type": "ALL",
                        "rows": 20,
                        "filtered": 100,
                        "attached_condition": "(t1.a < 5)"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        {
          "query_block": {
            "select_id": 2,
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 9,
              "filtered": 100,
              "attached_condition": "(t2.d > 800)"
            },
            "block-nl-join": {
              "table": {
                "table_name": "<derived4>",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((v1.max_c > 100) and (v1.a > 7))"
              },
              "buffer_type": "flat",
              "buffer_size": "256Kb",
              "join_type": "BNL",
              "materialized": {
                "query_block": {
                  "select_id": 4,
                  "having_condition": "((max_c < 707) and (max_c > 100))",
                  "filesort": {
                    "sort_key": "t1.a, t1.b",
                    "temporary_table": {
                      "table": {
                        "table_name": "t1",
                        "access_type": "ALL",
                        "rows": 20,
                        "filtered": 100,
                        "attached_condition": "(t1.a > 7)"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      ]
    }
  }
}
select * from v1,t2 where (v1.a<5) and (v1.b=t2.b) and (v1.b=19)
union 
select * from v1,t2 where ((v1.max_c>400) or (v1.avg_c>270)) and (v1.a<t2.a);
a	b	max_c	avg_c	a	b	c	d
1	19	107	107.0000	1	19	203	107
1	21	500	234.6000	2	3	207	207
1	21	500	234.6000	7	13	312	406
1	21	500	234.6000	8	64	248	107
1	21	500	234.6000	6	20	315	279
1	21	500	234.6000	8	80	800	314
1	21	500	234.6000	3	12	231	190
1	21	500	234.6000	6	23	303	909
6	20	315	279.3333	7	13	312	406
6	20	315	279.3333	8	64	248	107
6	20	315	279.3333	8	80	800	314
explain format=json 
select * from v1,t2 where (v1.a<5) and (v1.b=t2.b) and (v1.b=19)
union 
select * from v1,t2 where ((v1.max_c>400) or (v1.avg_c>270)) and (v1.a<t2.a);
EXPLAIN
{
  "query_block": {
    "union_result": {
      "table_name": "<union1,2>",
      "access_type": "ALL",
      "query_specifications": [
        {
          "query_block": {
            "select_id": 1,
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 9,
              "filtered": 100,
              "attached_condition": "(t2.b = 19)"
            },
            "block-nl-join": {
              "table": {
                "table_name": "<derived3>",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((v1.b = 19) and (v1.a < 5))"
              },
              "buffer_type": "flat",
              "buffer_size": "256Kb",
              "join_type": "BNL",
              "materialized": {
                "query_block": {
                  "select_id": 3,
                  "having_condition": "(max_c < 707)",
                  "filesort": {
                    "sort_key": "t1.a",
                    "temporary_table": {
                      "table": {
                        "table_name": "t1",
                        "access_type": "ALL",
                        "rows": 20,
                        "filtered": 100,
                        "attached_condition": "((t1.b = 19) and (t1.a < 5))"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        {
          "query_block": {
            "select_id": 2,
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 9,
              "filtered": 100
            },
            "block-nl-join": {
              "table": {
                "table_name": "<derived4>",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((v1.max_c > 400) or (v1.avg_c > 270))"
              },
              "buffer_type": "flat",
              "buffer_size": "256Kb",
              "join_type": "BNL",
              "attached_condition": "(((v1.max_c > 400) or (v1.avg_c > 270)) and (v1.a < t2.a))",
              "materialized": {
                "query_block": {
                  "select_id": 4,
                  "having_condition": "((max_c < 707) and ((max_c > 400) or (avg_c > 270)))",
                  "filesort": {
                    "sort_key": "t1.a, t1.b",
                    "temporary_table": {
                      "table": {
                        "table_name": "t1",
                        "access_type": "ALL",
                        "rows": 20,
                        "filtered": 100
                      }
                    }
                  }
                }
              }
            }
          }
        }
      ]
    }
  }
}
select * from v1,t2 where 
(t2.a=v1.a) or (v1.b=t2.b) and ((v1.a=1) or (v1.a=6))
union
select * from v1,t2 where ((v1.a>3) and (v1.b>27)) or (v1.max_c>550);
a	b	max_c	avg_c	a	b	c	d
1	19	107	107.0000	1	21	909	12
1	19	107	107.0000	1	19	203	107
1	21	500	234.6000	1	21	909	12
1	21	500	234.6000	1	19	203	107
6	20	315	279.3333	6	20	315	279
6	20	315	279.3333	6	23	303	909
8	33	404	213.6667	8	64	248	107
8	33	404	213.6667	8	80	800	314
8	33	404	213.6667	2	3	207	207
8	33	404	213.6667	1	21	909	12
8	33	404	213.6667	7	13	312	406
8	33	404	213.6667	6	20	315	279
8	33	404	213.6667	1	19	203	107
8	33	404	213.6667	3	12	231	190
8	33	404	213.6667	6	23	303	909
explain format=json 
select * from v1,t2 where 
(t2.a=v1.a) or (v1.b=t2.b) and ((v1.a=1) or (v1.a=6))
union
select * from v1,t2 where ((v1.a>3) and (v1.b>27)) or (v1.max_c>550);
EXPLAIN
{
  "query_block": {
    "union_result": {
      "table_name": "<union1,2>",
      "access_type": "ALL",
      "query_specifications": [
        {
          "query_block": {
            "select_id": 1,
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 9,
              "filtered": 100
            },
            "block-nl-join": {
              "table": {
                "table_name": "<derived3>",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              },
              "buffer_type": "flat",
              "buffer_size": "256Kb",
              "join_type": "BNL",
              "attached_condition": "((v1.a = t2.a) or ((v1.b = t2.b) and ((v1.a = 1) or (v1.a = 6))))",
              "materialized": {
                "query_block": {
                  "select_id": 3,
                  "having_condition": "(max_c < 707)",
                  "filesort": {
                    "sort_key": "t1.a, t1.b",
                    "temporary_table": {
                      "table": {
                        "table_name": "t1",
                        "access_type": "ALL",
                        "rows": 20,
                        "filtered": 100
                      }
                    }
                  }
                }
              }
            }
          }
        },
        {
          "query_block": {
            "select_id": 2,
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 9,
              "filtered": 100
            },
            "block-nl-join": {
              "table": {
                "table_name": "<derived4>",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(((v1.a > 3) and (v1.b > 27)) or (v1.max_c > 550))"
              },
              "buffer_type": "flat",
              "buffer_size": "256Kb",
              "join_type": "BNL",
              "attached_condition": "(((v1.a > 3) and (v1.b > 27)) or (v1.max_c > 550))",
              "materialized": {
                "query_block": {
                  "select_id": 4,
                  "having_condition": "((max_c < 707) and (((t1.a > 3) and (t1.b > 27)) or (max_c > 550)))",
                  "filesort": {
                    "sort_key": "t1.a, t1.b",
                    "temporary_table": {
                      "table": {
                        "table_name": "t1",
                        "access_type": "ALL",
                        "rows": 20,
                        "filtered": 100
                      }
                    }
                  }
                }
              }
            }
          }
        }
      ]
    }
  }
}
select * from v1,t2 where 
((v1.a=1) and (v1.a=t2.a)) and ((v1.max_c<500) or (v1.avg_c>500))
union
select * from v2,t2 where
((v2.a<t2.b) or (v2.max_c>200)) and (v2.b>10) and (t2.a<2)
union
select * from v2,t2 where
(v2.max_c=t2.c) and (v2.b<10);
a	b	max_c	avg_c	a	b	c	d
1	19	107	107.0000	1	21	909	12
1	19	107	107.0000	1	19	203	107
6	20	315	279.3333	1	21	909	12
6	20	315	279.3333	1	19	203	107
8	33	404	213.6667	1	21	909	12
8	33	404	213.6667	1	19	203	107
explain format=json  
select * from v1,t2 where 
((v1.a=1) and (v1.a=t2.a)) and ((v1.max_c<500) or (v1.avg_c>500))
union
select * from v2,t2 where
((v2.a<t2.b) or (v2.max_c>200)) and (v2.b>10) and (t2.a<2)
union
select * from v2,t2 where
(v2.max_c=t2.c) and (v2.b<10);
EXPLAIN
{
  "query_block": {
    "union_result": {
      "table_name": "<union1,2,3>",
      "access_type": "ALL",
      "query_specifications": [
        {
          "query_block": {
            "select_id": 1,
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 9,
              "filtered": 100,
              "attached_condition": "(t2.a = 1)"
            },
            "block-nl-join": {
              "table": {
                "table_name": "<derived4>",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((v1.a = 1) and ((v1.max_c < 500) or (v1.avg_c > 500)))"
              },
              "buffer_type": "flat",
              "buffer_size": "256Kb",
              "join_type": "BNL",
              "attached_condition": "((v1.max_c < 500) or (v1.avg_c > 500))",
              "materialized": {
                "query_block": {
                  "select_id": 4,
                  "having_condition": "((max_c < 707) and ((max_c < 500) or (avg_c > 500)))",
                  "filesort": {
                    "sort_key": "t1.b",
                    "temporary_table": {
                      "table": {
                        "table_name": "t1",
                        "access_type": "ALL",
                        "rows": 20,
                        "filtered": 100,
                        "attached_condition": "(t1.a = 1)"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        {
          "query_block": {
            "select_id": 2,
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 9,
              "filtered": 100,
              "attached_condition": "(t2.a < 2)"
            },
            "block-nl-join": {
              "table": {
                "table_name": "<derived5>",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(v2.b > 10)"
              },
              "buffer_type": "flat",
              "buffer_size": "256Kb",
              "join_type": "BNL",
              "attached_condition": "((v2.a < t2.b) or (v2.max_c > 200))",
              "materialized": {
                "query_block": {
                  "select_id": 5,
                  "having_condition": "(max_c < 707)",
                  "filesort": {
                    "sort_key": "t1.a, t1.b",
                    "temporary_table": {
                      "table": {
                        "table_name": "t1",
                        "access_type": "ALL",
                        "rows": 20,
                        "filtered": 100,
                        "attached_condition": "((t1.a > 5) and (t1.b > 10))"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        {
          "query_block": {
            "select_id": 3,
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 9,
              "filtered": 100,
              "attached_condition": "(t2.c is not null)"
            },
            "table": {
              "table_name": "<derived6>",
              "access_type": "ref",
              "possible_keys": ["key0"],
              "key": "key0",
              "key_length": "5",
              "used_key_parts": ["max_c"],
              "ref": ["test.t2.c"],
              "rows": 2,
              "filtered": 100,
              "attached_condition": "(v2.b < 10)",
              "materialized": {
                "query_block": {
                  "select_id": 6,
                  "having_condition": "(max_c < 707)",
                  "filesort": {
                    "sort_key": "t1.a, t1.b",
                    "temporary_table": {
                      "table": {
                        "table_name": "t1",
                        "access_type": "ALL",
                        "rows": 20,
                        "filtered": 100,
                        "attached_condition": "((t1.a > 5) and (t1.b < 10))"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      ]
    }
  }
}
create view v4 as 
select a, b, min(c) as c from t1
where t1.a<10 group by a,b having c > 109
union
select a, b, max(c) as c from t1
where t1.b>10 group by a,b having c < 300;
select * from v4,t2 where (v4.a<3) and (v4.c>100);
a	b	c	a	b	c	d
1	19	107	2	3	207	207
1	19	107	1	21	909	12
1	19	107	7	13	312	406
1	19	107	8	64	248	107
1	19	107	6	20	315	279
1	19	107	1	19	203	107
1	19	107	8	80	800	314
1	19	107	3	12	231	190
1	19	107	6	23	303	909
explain format=json select * from v4,t2 where (v4.a<3) and (v4.c>100);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 40,
        "filtered": 100,
        "attached_condition": "((v4.a < 3) and (v4.c > 100))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "materialized": {
        "query_block": {
          "union_result": {
            "table_name": "<union2,3>",
            "access_type": "ALL",
            "query_specifications": [
              {
                "query_block": {
                  "select_id": 2,
                  "having_condition": "((c > 109) and (c > 100))",
                  "filesort": {
                    "sort_key": "t1.a, t1.b",
                    "temporary_table": {
                      "table": {
                        "table_name": "t1",
                        "access_type": "ALL",
                        "rows": 20,
                        "filtered": 100,
                        "attached_condition": "((t1.a < 10) and (t1.a < 3))"
                      }
                    }
                  }
                }
              },
              {
                "query_block": {
                  "select_id": 3,
                  "having_condition": "((c < 300) and (c > 100))",
                  "filesort": {
                    "sort_key": "t1.a, t1.b",
                    "temporary_table": {
                      "table": {
                        "table_name": "t1",
                        "access_type": "ALL",
                        "rows": 20,
                        "filtered": 100,
                        "attached_condition": "((t1.b > 10) and (t1.a < 3))"
                      }
                    }
                  }
                }
              }
            ]
          }
        }
      }
    }
  }
}
select * from v4,t2 where
((v4.a<2) or (v4.c>800)) and (v4.b>12);
a	b	c	a	b	c	d
1	19	107	2	3	207	207
1	19	107	1	21	909	12
1	19	107	7	13	312	406
1	19	107	8	64	248	107
1	19	107	6	20	315	279
1	19	107	1	19	203	107
1	19	107	8	80	800	314
1	19	107	3	12	231	190
1	19	107	6	23	303	909
explain format=json   
select * from v4,t2 where
((v4.a<2) or (v4.c>800)) and (v4.b>12);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 40,
        "filtered": 100,
        "attached_condition": "(((v4.a < 2) or (v4.c > 800)) and (v4.b > 12))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "((v4.a < 2) or (v4.c > 800))",
      "materialized": {
        "query_block": {
          "union_result": {
            "table_name": "<union2,3>",
            "access_type": "ALL",
            "query_specifications": [
              {
                "query_block": {
                  "select_id": 2,
                  "having_condition": "((c > 109) and ((t1.a < 2) or (c > 800)))",
                  "filesort": {
                    "sort_key": "t1.a, t1.b",
                    "temporary_table": {
                      "table": {
                        "table_name": "t1",
                        "access_type": "ALL",
                        "rows": 20,
                        "filtered": 100,
                        "attached_condition": "((t1.a < 10) and (t1.b > 12))"
                      }
                    }
                  }
                }
              },
              {
                "query_block": {
                  "select_id": 3,
                  "having_condition": "((c < 300) and ((t1.a < 2) or (c > 800)))",
                  "filesort": {
                    "sort_key": "t1.a, t1.b",
                    "temporary_table": {
                      "table": {
                        "table_name": "t1",
                        "access_type": "ALL",
                        "rows": 20,
                        "filtered": 100,
                        "attached_condition": "((t1.b > 10) and (t1.b > 12))"
                      }
                    }
                  }
                }
              }
            ]
          }
        }
      }
    }
  }
}
select * from v4,t2 where
(v4.a=1) and (v4.a=t2.a) and (v4.c<200);
a	b	c	a	b	c	d
1	19	107	1	21	909	12
1	19	107	1	19	203	107
explain format=json 
select * from v4,t2 where
(v4.a=1) and (v4.a=t2.a) and (v4.c<200);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "(t2.a = 1)"
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 40,
        "filtered": 100,
        "attached_condition": "((v4.a = 1) and (v4.c < 200))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "materialized": {
        "query_block": {
          "union_result": {
            "table_name": "<union2,3>",
            "access_type": "ALL",
            "query_specifications": [
              {
                "query_block": {
                  "select_id": 2,
                  "having_condition": "((c > 109) and (c < 200))",
                  "filesort": {
                    "sort_key": "t1.b",
                    "temporary_table": {
                      "table": {
                        "table_name": "t1",
                        "access_type": "ALL",
                        "rows": 20,
                        "filtered": 100,
                        "attached_condition": "(t1.a = 1)"
                      }
                    }
                  }
                }
              },
              {
                "query_block": {
                  "select_id": 3,
                  "having_condition": "((c < 300) and (c < 200))",
                  "filesort": {
                    "sort_key": "t1.b",
                    "temporary_table": {
                      "table": {
                        "table_name": "t1",
                        "access_type": "ALL",
                        "rows": 20,
                        "filtered": 100,
                        "attached_condition": "((t1.a = 1) and (t1.b > 10))"
                      }
                    }
                  }
                }
              }
            ]
          }
        }
      }
    }
  }
}
select * from v4,v1,t2 where
(v4.a=v1.a) and (v1.a=t2.a) and (t2.a=1) and ((v4.c>800) or (v1.max_c>200));
a	b	c	a	b	max_c	avg_c	a	b	c	d
1	19	107	1	21	500	234.6000	1	21	909	12
1	19	107	1	21	500	234.6000	1	19	203	107
explain format=json  
select * from v4,v1,t2 where
(v4.a=v1.a) and (v1.a=t2.a) and (t2.a=1) and ((v4.c>800) or (v1.max_c>200));
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "(t2.a = 1)"
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived4>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "(v1.a = 1)"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "materialized": {
        "query_block": {
          "select_id": 4,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.a = 1)"
              }
            }
          }
        }
      }
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 40,
        "filtered": 100,
        "attached_condition": "(v4.a = 1)"
      },
      "buffer_type": "incremental",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "((v4.c > 800) or (v1.max_c > 200))",
      "materialized": {
        "query_block": {
          "union_result": {
            "table_name": "<union2,3>",
            "access_type": "ALL",
            "query_specifications": [
              {
                "query_block": {
                  "select_id": 2,
                  "having_condition": "(c > 109)",
                  "filesort": {
                    "sort_key": "t1.b",
                    "temporary_table": {
                      "table": {
                        "table_name": "t1",
                        "access_type": "ALL",
                        "rows": 20,
                        "filtered": 100,
                        "attached_condition": "(t1.a = 1)"
                      }
                    }
                  }
                }
              },
              {
                "query_block": {
                  "select_id": 3,
                  "having_condition": "(c < 300)",
                  "filesort": {
                    "sort_key": "t1.b",
                    "temporary_table": {
                      "table": {
                        "table_name": "t1",
                        "access_type": "ALL",
                        "rows": 20,
                        "filtered": 100,
                        "attached_condition": "((t1.a = 1) and (t1.b > 10))"
                      }
                    }
                  }
                }
              }
            ]
          }
        }
      }
    }
  }
}
create view v5 as 
select a, b, min(c) as c from t1
where t1.a<10 group by a,b having c > 109
union
select a, b, max(c) as c from t1
where t1.b>10 group by a,b having c < 300
union
select a, b, avg(c) as c from t1
where t1.c>300 group by a,b having c < 707;
select * from v5,t2 where 
((v5.a=6) or (v5.a=8)) and (v5.c>200) and (v5.a=t2.a);
a	b	c	a	b	c	d
8	33	404.0000	8	64	248	107
6	20	312.0000	6	20	315	279
6	20	214.0000	6	20	315	279
8	33	404.0000	8	80	800	314
6	20	312.0000	6	23	303	909
6	20	214.0000	6	23	303	909
explain format=json 
select * from v5,t2 where 
((v5.a=6) or (v5.a=8)) and (v5.c>200) and (v5.a=t2.a);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "(((t2.a = 6) or (t2.a = 8)) and (t2.a is not null))"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["a"],
      "ref": ["test.t2.a"],
      "rows": 6,
      "filtered": 100,
      "attached_condition": "(v5.c > 200)",
      "materialized": {
        "query_block": {
          "union_result": {
            "table_name": "<union2,3,4>",
            "access_type": "ALL",
            "query_specifications": [
              {
                "query_block": {
                  "select_id": 2,
                  "having_condition": "((c > 109) and (c > 200))",
                  "filesort": {
                    "sort_key": "t1.a, t1.b",
                    "temporary_table": {
                      "table": {
                        "table_name": "t1",
                        "access_type": "ALL",
                        "rows": 20,
                        "filtered": 100,
                        "attached_condition": "((t1.a < 10) and ((t1.a = 6) or (t1.a = 8)))"
                      }
                    }
                  }
                }
              },
              {
                "query_block": {
                  "select_id": 3,
                  "having_condition": "((c < 300) and (c > 200))",
                  "filesort": {
                    "sort_key": "t1.a, t1.b",
                    "temporary_table": {
                      "table": {
                        "table_name": "t1",
                        "access_type": "ALL",
                        "rows": 20,
                        "filtered": 100,
                        "attached_condition": "((t1.b > 10) and ((t1.a = 6) or (t1.a = 8)))"
                      }
                    }
                  }
                }
              },
              {
                "query_block": {
                  "select_id": 4,
                  "having_condition": "((c < 707) and (c > 200))",
                  "filesort": {
                    "sort_key": "t1.a, t1.b",
                    "temporary_table": {
                      "table": {
                        "table_name": "t1",
                        "access_type": "ALL",
                        "rows": 20,
                        "filtered": 100,
                        "attached_condition": "((t1.c > 300) and ((t1.a = 6) or (t1.a = 8)))"
                      }
                    }
                  }
                }
              }
            ]
          }
        }
      }
    }
  }
}
drop view v4,v5;
create table t3(a int, b double, c double);
insert into t3 values 
(1,23.4,14.3333), (1,12.5,18.9), (3,12.5,18.9),
(4,33.4,14.3333), (4,14.3333,13.65), (5,17.89,7.22),
(6,33.4,14.3), (10,33.4,13.65), (11,33.4,13.65);
create table t4(a int, b double, c double);
insert into t4 values 
(1,22.4,14.3333), (1,12.5,18.9), (2,22.4,18.9),
(4,33.4,14.3333), (5,22.4,13.65), (7,17.89,18.9),
(6,33.4,14.3333), (10,31.4,13.65), (12,33.4,13.65);
create view v4 as
select a, avg(a/4) as avg_a, b, c from t3
where (b>12.2) group by b,c having (avg_a<22.333);
select * from v4,t4 where
(v4.a=t4.a) and (v4.avg_a>0.45) and (v4.b>10);
a	avg_a	b	c	a	b	c
1	0.50000000	12.5	18.9	1	22.4	14.3333
1	0.50000000	12.5	18.9	1	12.5	18.9
4	1.00000000	33.4	14.3333	4	33.4	14.3333
4	1.00000000	14.3333	13.65	4	33.4	14.3333
5	1.25000000	17.89	7.22	5	22.4	13.65
6	1.50000000	33.4	14.3	6	33.4	14.3333
10	2.62500000	33.4	13.65	10	31.4	13.65
explain format=json
select * from v4,t4 where
(v4.a=t4.a) and (v4.avg_a>0.45) and (v4.b>10);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t4",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "(t4.a is not null)"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["a"],
      "ref": ["test.t4.a"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "((v4.avg_a > 0.45) and (v4.b > 10))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((avg_a < 22.333) and (avg_a > 0.45))",
          "filesort": {
            "sort_key": "t3.b, t3.c",
            "temporary_table": {
              "table": {
                "table_name": "t3",
                "access_type": "ALL",
                "rows": 9,
                "filtered": 100,
                "attached_condition": "((t3.b > 12.2) and (t3.b > 10))"
              }
            }
          }
        }
      }
    }
  }
}
select * from v4,t4 where
(v4.b=v4.c) and (v4.c=t4.c) and ((t4.c>10) or (v4.a=1));
a	avg_a	b	c	a	b	c
explain format=json
select * from v4,t4 where
(v4.b=v4.c) and (v4.c=t4.c) and ((t4.c>10) or (v4.a=1));
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t4",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "((t4.c is not null) and (t4.c is not null))"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "18",
      "used_key_parts": ["b", "c"],
      "ref": ["test.t4.c", "test.t4.c"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "((t4.c > 10) or (v4.a = 1))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((avg_a < 22.333) and ((t3.b > 10) or (t3.a = 1)))",
          "filesort": {
            "sort_key": "t3.b, t3.c",
            "temporary_table": {
              "table": {
                "table_name": "t3",
                "access_type": "ALL",
                "rows": 9,
                "filtered": 100,
                "attached_condition": "((t3.c = t3.b) and (t3.b > 12.2))"
              }
            }
          }
        }
      }
    }
  }
}
select * from v4,t4 where
(((v4.a>0.2) or (v4.b<17)) or (t4.c>17)) and (t4.c=v4.c) and (v4.c>18);
a	avg_a	b	c	a	b	c
1	0.50000000	12.5	18.9	1	12.5	18.9
1	0.50000000	12.5	18.9	2	22.4	18.9
1	0.50000000	12.5	18.9	7	17.89	18.9
explain format=json  
select * from v4,t4 where
(((v4.a>0.2) or (v4.b<17)) or (t4.c>17)) and (t4.c=v4.c) and (v4.c>18);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t4",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "((t4.c > 18) and (t4.c is not null))"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "9",
      "used_key_parts": ["c"],
      "ref": ["test.t4.c"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "((v4.a > 0.2) or (v4.b < 17) or (t4.c > 17))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((avg_a < 22.333) and ((t3.a > 0.2) or (t3.b < 17) or (t3.c > 17)))",
          "filesort": {
            "sort_key": "t3.b, t3.c",
            "temporary_table": {
              "table": {
                "table_name": "t3",
                "access_type": "ALL",
                "rows": 9,
                "filtered": 100,
                "attached_condition": "((t3.b > 12.2) and (t3.c > 18))"
              }
            }
          }
        }
      }
    }
  }
}
drop table t3,t4;
drop view v4;
create table t3(a char, b char(8), c int);
insert into t3 values
('a','Ivan',1), ('b','Vika',2), ('b','Inga',6), ('c','Vika',7),
('b','Ivan',7), ('a','Alex',6), ('b','Inga',5), ('d','Ron',9),
('d','Harry',2), ('d','Hermione',3), ('c','Ivan',3), ('c','Harry',4);
create table t4(a char, b char(8), c int);
insert into t4 values
('b','Ivan',1), ('c','Vinny',3), ('c','Inga',9), ('a','Vika',1),
('c','Ivan',2), ('b','Ali',6), ('c','Inga',2), ('a','Ron',9),
('d','Harry',1), ('b','Hermes',3), ('b','Ivan',11), ('b','Harry',4);
create view v4 as 
select a, b, max(c) as max_c from t3 group by a,b having max_c < 9;
select * from v4,t4 where 
(v4.a=t4.a) and (v4.b='Vika') and (v4.max_c>2);
a	b	max_c	a	b	c
c	Vika	7	c	Vinny	3
c	Vika	7	c	Inga	9
c	Vika	7	c	Ivan	2
c	Vika	7	c	Inga	2
explain format=json
select * from v4,t4 where 
(v4.a=t4.a) and (v4.b='Vika') and (v4.max_c>2);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t4",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "(t4.a is not null)"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "2",
      "used_key_parts": ["a"],
      "ref": ["test.t4.a"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "((v4.b = 'Vika') and (v4.max_c > 2))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "((max_c < 9) and (max_c > 2))",
          "filesort": {
            "sort_key": "t3.a",
            "temporary_table": {
              "table": {
                "table_name": "t3",
                "access_type": "ALL",
                "rows": 12,
                "filtered": 100,
                "attached_condition": "(t3.b = 'Vika')"
              }
            }
          }
        }
      }
    }
  }
}
select * from v4,t4 where 
(v4.a=t4.a) and (t4.a='b') and ((v4.b='Vika') or (v4.b='Ali'));
a	b	max_c	a	b	c
b	Vika	2	b	Ivan	1
b	Vika	2	b	Ali	6
b	Vika	2	b	Hermes	3
b	Vika	2	b	Ivan	11
b	Vika	2	b	Harry	4
explain format=json
select * from v4,t4 where 
(v4.a=t4.a) and (t4.a='b') and ((v4.b='Vika') or (v4.b='Ali'));
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "<derived2>",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "((v4.a = 'b') and ((v4.b = 'Vika') or (v4.b = 'Ali')))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 9)",
          "filesort": {
            "sort_key": "t3.b",
            "temporary_table": {
              "table": {
                "table_name": "t3",
                "access_type": "ALL",
                "rows": 12,
                "filtered": 100,
                "attached_condition": "((t3.a = 'b') and ((t3.b = 'Vika') or (t3.b = 'Ali')))"
              }
            }
          }
        }
      }
    },
    "block-nl-join": {
      "table": {
        "table_name": "t4",
        "access_type": "ALL",
        "rows": 12,
        "filtered": 100,
        "attached_condition": "(t4.a = 'b')"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL"
    }
  }
}
select * from v4,t4 where 
(v4.a='c') and (v4.b<'Hermes') and ((v4.b=t4.b) or (v4.max_c>20));
a	b	max_c	a	b	c
c	Harry	4	d	Harry	1
c	Harry	4	b	Harry	4
explain format=json
select * from v4,t4 where 
(v4.a='c') and (v4.b<'Hermes') and ((v4.b=t4.b) or (v4.max_c>20));
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "<derived2>",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "((v4.a = 'c') and (v4.b < 'Hermes'))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(max_c < 9)",
          "filesort": {
            "sort_key": "t3.b",
            "temporary_table": {
              "table": {
                "table_name": "t3",
                "access_type": "ALL",
                "rows": 12,
                "filtered": 100,
                "attached_condition": "((t3.a = 'c') and (t3.b < 'Hermes'))"
              }
            }
          }
        }
      }
    },
    "block-nl-join": {
      "table": {
        "table_name": "t4",
        "access_type": "ALL",
        "rows": 12,
        "filtered": 100
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "((t4.b = v4.b) or (v4.max_c > 20))"
    }
  }
}
drop table t3,t4;
drop view v4;
create view v4 as
select a, b, min(max_c) as min_c from v1
where (v1.a<15) group by a,b;
select * from v4,v1 where
(v4.a<13) and (v1.a>5) and (v1.b>12);
a	b	min_c	a	b	max_c	avg_c
1	19	107	6	20	315	279.3333
1	21	500	6	20	315	279.3333
5	16	207	6	20	315	279.3333
5	27	132	6	20	315	279.3333
6	20	315	6	20	315	279.3333
8	33	404	6	20	315	279.3333
1	19	107	8	33	404	213.6667
1	21	500	8	33	404	213.6667
5	16	207	8	33	404	213.6667
5	27	132	8	33	404	213.6667
6	20	315	8	33	404	213.6667
8	33	404	8	33	404	213.6667
explain format=json
select * from v4,v1 where
(v4.a<13) and (v1.a>5) and (v1.b>12);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "<derived2>",
      "access_type": "ALL",
      "rows": 20,
      "filtered": 100,
      "attached_condition": "(v4.a < 13)",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "filesort": {
            "sort_key": "v1.a, v1.b",
            "temporary_table": {
              "table": {
                "table_name": "<derived3>",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((v1.a < 15) and (v1.a < 13))",
                "materialized": {
                  "query_block": {
                    "select_id": 3,
                    "having_condition": "(max_c < 707)",
                    "filesort": {
                      "sort_key": "t1.a, t1.b",
                      "temporary_table": {
                        "table": {
                          "table_name": "t1",
                          "access_type": "ALL",
                          "rows": 20,
                          "filtered": 100,
                          "attached_condition": "((t1.a < 15) and (t1.a < 13))"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived4>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "((v1.a > 5) and (v1.b > 12))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "materialized": {
        "query_block": {
          "select_id": 4,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((t1.a > 5) and (t1.b > 12))"
              }
            }
          }
        }
      }
    }
  }
}
select * from v4,v1,t2 where
(v4.a=t2.a) and (v4.a=v1.a) and (v1.b>30);
a	b	min_c	a	b	max_c	avg_c	a	b	c	d
8	33	404	8	33	404	213.6667	8	64	248	107
8	33	404	8	33	404	213.6667	8	80	800	314
explain format=json
select * from v4,v1,t2 where
(v4.a=t2.a) and (v4.a=v1.a) and (v1.b>30);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "((t2.a is not null) and (t2.a is not null))"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key1"],
      "key": "key1",
      "key_length": "5",
      "used_key_parts": ["a"],
      "ref": ["test.t2.a"],
      "rows": 2,
      "filtered": 100,
      "materialized": {
        "query_block": {
          "select_id": 2,
          "filesort": {
            "sort_key": "v1.a, v1.b",
            "temporary_table": {
              "table": {
                "table_name": "<derived3>",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(v1.a < 15)",
                "materialized": {
                  "query_block": {
                    "select_id": 3,
                    "having_condition": "(max_c < 707)",
                    "filesort": {
                      "sort_key": "t1.a, t1.b",
                      "temporary_table": {
                        "table": {
                          "table_name": "t1",
                          "access_type": "ALL",
                          "rows": 20,
                          "filtered": 100,
                          "attached_condition": "(t1.a < 15)"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "table": {
      "table_name": "<derived4>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["a"],
      "ref": ["test.t2.a"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "(v1.b > 30)",
      "materialized": {
        "query_block": {
          "select_id": 4,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "(t1.b > 30)"
              }
            }
          }
        }
      }
    }
  }
}
select * from v4,v1,t2 where
(v4.a=t2.a) and (v4.a>1) and (v4.a=v1.a) and (v4.min_c>100) and (v1.b<30);
a	b	min_c	a	b	max_c	avg_c	a	b	c	d
6	20	315	6	20	315	279.3333	6	20	315	279
6	20	315	6	20	315	279.3333	6	23	303	909
explain format=json
select * from v4,v1,t2 where
(v4.a=t2.a) and (v4.a>1) and (v4.a=v1.a) and (v4.min_c>100) and (v1.b<30);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100,
      "attached_condition": "((t2.a > 1) and (t2.a is not null) and (t2.a is not null))"
    },
    "table": {
      "table_name": "<derived2>",
      "access_type": "ref",
      "possible_keys": ["key1"],
      "key": "key1",
      "key_length": "5",
      "used_key_parts": ["a"],
      "ref": ["test.t2.a"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "(v4.min_c > 100)",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "having_condition": "(min_c > 100)",
          "filesort": {
            "sort_key": "v1.a, v1.b",
            "temporary_table": {
              "table": {
                "table_name": "<derived3>",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((v1.a < 15) and (v1.a > 1))",
                "materialized": {
                  "query_block": {
                    "select_id": 3,
                    "having_condition": "(max_c < 707)",
                    "filesort": {
                      "sort_key": "t1.a, t1.b",
                      "temporary_table": {
                        "table": {
                          "table_name": "t1",
                          "access_type": "ALL",
                          "rows": 20,
                          "filtered": 100,
                          "attached_condition": "((t1.a < 15) and (t1.a > 1))"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "table": {
      "table_name": "<derived4>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["a"],
      "ref": ["test.t2.a"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "(v1.b < 30)",
      "materialized": {
        "query_block": {
          "select_id": 4,
          "having_condition": "(max_c < 707)",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((t1.a > 1) and (t1.b < 30))"
              }
            }
          }
        }
      }
    }
  }
}
select * from v4,v1 where
(((v4.b>10) and (v4.a>1)) or (v4.b<20)) and (v1.max_c>200);
a	b	min_c	a	b	max_c	avg_c
1	19	107	1	21	500	234.6000
5	16	207	1	21	500	234.6000
5	27	132	1	21	500	234.6000
6	20	315	1	21	500	234.6000
8	33	404	1	21	500	234.6000
1	19	107	5	16	207	207.0000
5	16	207	5	16	207	207.0000
5	27	132	5	16	207	207.0000
6	20	315	5	16	207	207.0000
8	33	404	5	16	207	207.0000
1	19	107	6	20	315	279.3333
5	16	207	6	20	315	279.3333
5	27	132	6	20	315	279.3333
6	20	315	6	20	315	279.3333
8	33	404	6	20	315	279.3333
1	19	107	8	33	404	213.6667
5	16	207	8	33	404	213.6667
5	27	132	8	33	404	213.6667
6	20	315	8	33	404	213.6667
8	33	404	8	33	404	213.6667
explain format=json
select * from v4,v1,t2 where
(((v4.b>10) and (v4.a>1)) or (v4.b<20)) and (v1.max_c>200) and (v1.a=v4.a);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t2",
      "access_type": "ALL",
      "rows": 9,
      "filtered": 100
    },
    "block-nl-join": {
      "table": {
        "table_name": "<derived2>",
        "access_type": "ALL",
        "rows": 20,
        "filtered": 100,
        "attached_condition": "(((v4.b > 10) and (v4.a > 1)) or (v4.b < 20))"
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "((((v4.b > 10) and (v4.a > 1)) or (v4.b < 20)) and (v4.a is not null))",
      "materialized": {
        "query_block": {
          "select_id": 2,
          "filesort": {
            "sort_key": "v1.a, v1.b",
            "temporary_table": {
              "table": {
                "table_name": "<derived3>",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100,
                "attached_condition": "((v1.a < 15) and (((v1.b > 10) and (v1.a > 1)) or (v1.b < 20)))",
                "materialized": {
                  "query_block": {
                    "select_id": 3,
                    "having_condition": "(max_c < 707)",
                    "filesort": {
                      "sort_key": "t1.a, t1.b",
                      "temporary_table": {
                        "table": {
                          "table_name": "t1",
                          "access_type": "ALL",
                          "rows": 20,
                          "filtered": 100,
                          "attached_condition": "((t1.a < 15) and (((t1.b > 10) and (t1.a > 1)) or (t1.b < 20)))"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "table": {
      "table_name": "<derived4>",
      "access_type": "ref",
      "possible_keys": ["key0"],
      "key": "key0",
      "key_length": "5",
      "used_key_parts": ["a"],
      "ref": ["v4.a"],
      "rows": 2,
      "filtered": 100,
      "attached_condition": "(v1.max_c > 200)",
      "materialized": {
        "query_block": {
          "select_id": 4,
          "having_condition": "((max_c < 707) and (max_c > 200))",
          "filesort": {
            "sort_key": "t1.a, t1.b",
            "temporary_table": {
              "table": {
                "table_name": "t1",
                "access_type": "ALL",
                "rows": 20,
                "filtered": 100
              }
            }
          }
        }
      }
    }
  }
}
drop view v1,v2,v3,v4;
drop table t1,t2;
